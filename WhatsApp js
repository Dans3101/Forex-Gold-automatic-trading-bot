import qrcode from "qrcode-terminal";
import pkg from "whatsapp-web.js";
const { Client, LocalAuth } = pkg;

export const client = new Client({
  authStrategy: new LocalAuth(),        // saves session so you scan QR only once
  puppeteer: { headless: true }
});

client.on("qr", (qr) => {
  console.log("📲 Scan this QR with your WhatsApp:");
  qrcode.generate(qr, { small: true });
});

client.on("ready", () => {
  console.log("✅ WhatsApp bot is ready!");
});

export const sendToGroup = async (groupName, message) => {
  const chats = await client.getChats();
  const group = chats.find(c => c.isGroup && c.name === groupName);
  if (!group) {
    console.log(`⚠️ Group "${groupName}" not found. Double-check the exact name.`);
    return;
  }
  await client.sendMessage(group.id._serialized, message);
};

export const initWhatsApp = async () => {
  await client.initialize();
};