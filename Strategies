// strategies.js
// Safer strategies for XAUUSD

// Moving Average Strategy (5 vs 20 period crossover)
export function movingAverageStrategy(prices) {
  const shortMA = prices.slice(0, 5).reduce((a, b) => a + b, 0) / 5;
  const longMA = prices.slice(0, 20).reduce((a, b) => a + b, 0) / 20;

  if (shortMA > longMA) return "buy";
  if (shortMA < longMA) return "sell";
  return "wait";
}

// Breakout Strategy (support/resistance levels)
export function breakoutStrategy(prices) {
  const recentHigh = Math.max(...prices.slice(0, 20));  // last 20 candles
  const recentLow = Math.min(...prices.slice(0, 20));
  const currentPrice = prices[0];

  if (currentPrice > recentHigh) return "buy";   // breakout above resistance
  if (currentPrice < recentLow) return "sell";   // breakout below support
  return "wait";
}

// Combine strategies
export function combinedStrategy(data) {
  const maSignal = movingAverageStrategy(data.prices);
  const breakoutSignal = breakoutStrategy(data.prices);

  if (maSignal === "buy" && breakoutSignal === "buy") return "buy";
  if (maSignal === "sell" && breakoutSignal === "sell") return "sell";
  return "wait";
}